<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Court Data Fetcher</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script>
      // Function to populate district dropdown based on selected state
      function updateDistricts() {
          var districtsByState = {{ districts | tojson }};
          var stateSelect = document.getElementById("state");
          var districtSelect = document.getElementById("district");
          var selectedState = stateSelect.value;

          districtSelect.innerHTML = '<option value="" disabled selected>Select district</option>';
          districtSelect.disabled = true;
          if (selectedState && districtsByState[selectedState]) {
              districtsByState[selectedState].forEach(function(district) {
                var option = document.createElement("option");
                option.value = district;
                option.text = district;
                districtSelect.add(option);
              });
              districtSelect.disabled = false;
          }
      }

      // Disable district dropdown on page load if no state selected
      window.onload = function() {
          var districtSelect = document.getElementById("district");
          if (!document.getElementById("state").value) {
              districtSelect.disabled = true;
          }
      };
    </script>
</head>
<body class="container mt-4">
    <h2>Indian Court Case Data Fetcher</h2>

    <form method="POST" class="mb-4">
        <div class="mb-3">
            <label for="state" class="form-label">State:</label>
            <select id="state" name="state" class="form-select" onchange="updateDistricts()" required>
                <option value="" disabled {% if not selected_state %}selected{% endif %}>Select state</option>
                {% for state in states %}
                <option value="{{ state }}" {% if selected_state == state %}selected{% endif %}>{{ state }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="district" class="form-label">District:</label>
            <select id="district" name="district" class="form-select" required {% if not selected_state %}disabled{% endif %}>
                <option value="" disabled selected>Select district</option>
                {% if selected_state %}
                    {% for district in districts[selected_state] %}
                    <option value="{{ district }}" {% if selected_district == district %}selected{% endif %}>{{ district }}</option>
                    {% endfor %}
                {% endif %}
            </select>
        </div>

        <div class="mb-3">
            <label for="court_type" class="form-label">Court Type:</label>
            <select id="court_type" name="court_type" class="form-select" required>
                <option value="" disabled selected>Select court type</option>
                {% for court in courts %}
                <option value="{{ court }}">{{ court }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="case_type" class="form-label">Case Type:</label>
            <select id="case_type" name="case_type" class="form-select" required>
                <option value="" disabled selected>Select case type</option>
                {% for ctype in case_types %}
                <option value="{{ ctype }}">{{ ctype }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="case_number" class="form-label">Case Number:</label>
            <select id="case_number" name="case_number" class="form-select" required>
                <option value="" disabled selected>Select case number</option>
                {% for num in case_numbers %}
                <option value="{{ num }}">{{ num }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="case_year" class="form-label">Year:</label>
            <select id="case_year" name="case_year" class="form-select" required>
                <option value="" disabled selected>Select year</option>
                {% for year in case_years %}
                <option value="{{ year }}">{{ year }}</option>
                {% endfor %}
            </select>
        </div>

        <button type="submit" class="btn btn-primary">Fetch Case Details</button>
    </form>

    {% if details %}
    <div class="card">
        <div class="card-body">
            <h5>Case Summary</h5>
            <table class="table table-bordered">
                <tr><th>State</th><td>{{ selected_state }}</td></tr>
                <tr><th>District</th><td>{{ selected_district }}</td></tr>
                <tr><th>Court Type</th><td>{{ details.court_type }}</td></tr>
                <tr><th>Case Type</th><td>{{ details.case_type }}</td></tr>
                <tr><th>Filing Number</th><td>{{ details.filing_number }}</td></tr>
                <tr><th>Filing Date</th><td>{{ details.filing_date }}</td></tr>
                <tr><th>Registration Number</th><td>{{ details.registration_number }}</td></tr>
                <tr><th>Registration Date</th><td>{{ details.registration_date }}</td></tr>
                <tr><th>CNR Number</th><td>{{ details.cnr_number }}</td></tr>
                <tr><th>First Hearing</th><td>{{ details.first_hearing }}</td></tr>
                <tr><th>Decision Date</th><td>{{ details.decision_date }}</td></tr>
                <tr><th>Status</th><td>{{ details.case_status }}</td></tr>
                <tr><th>Nature of Disposal</th><td>{{ details.nature_of_disposal }}</td></tr>
                <tr><th>Court & Judge</th><td>{{ details.judge }}</td></tr>
                <tr><th>Petitioners</th><td>{{ details.petitioners | join(', ') }}</td></tr>
                <tr><th>Respondents</th><td>{{ details.respondents | join(', ') }}</td></tr>
            </table>

            {% if details.orders %}
            <h6 class="mt-4">Orders / Judicial Proceedings</h6>
            <table class="table table-bordered">
                <tr><th>Order #</th><th>Date</th><th>Details</th><th>Download</th></tr>
                {% for order in details.orders %}
                <tr>
                    <td>{{ order.number }}</td>
                    <td>{{ order.date }}</td>
                    <td>{{ order.details }}</td>
                    <td>
                        {% if order.pdf_link %}
                        <a href="{{ url_for('download_file', filename=order.pdf_link) }}" target="_blank" class="btn btn-sm btn-success">PDF</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </table>
            {% endif %}

            {% if details.histories %}
            <h6 class="mt-4">Case History</h6>
            <table class="table table-bordered">
                <tr><th>Entry #</th><th>Judge</th><th>Business Date</th><th>Hearing Date</th><th>Purpose</th></tr>
                {% for history in details.histories %}
                <tr>
                    <td>{{ history.entry }}</td>
                    <td>{{ history.judge }}</td>
                    <td>{{ history.business_date }}</td>
                    <td>{{ history.hearing_date }}</td>
                    <td>{{ history.purpose }}</td>
                </tr>
                {% endfor %}
            </table>
            {% endif %}

            {% if details.acts %}
            <h6 class="mt-4">Applied Acts and Sections</h6>
            <table class="table table-bordered">
                <tr><th>Act</th><th>Section</th></tr>
                {% for act in details.acts %}
                <tr><td>{{ act.act_name }}</td><td>{{ act.section }}</td></tr>
                {% endfor %}
            </table>
            {% endif %}
        </div>
    </div>
    {% endif %}
</body>
</html>
